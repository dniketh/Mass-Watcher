<!DOCTYPE html> 
<html>
  
<!-- Meta tag Keywords -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<head>
  <link rel="stylesheet" href="mainstyle.css" type="text/css" media="all" /> <!-- Style-CSS --> 
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <!--Chart.js-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  <script src="node_modules/chart.js/dist/Chart.js"></script>
</head>
    <body>

      <div class="heading">
        <center>
          <h1>

         <span>
            <img src="favicon.ico"></span>
                    </span>Mass Watcher </h1>
        </center>
      </div>

      <nav class="navb navbar-expand-lg navbar-light bg-light">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <div class="navbr">
          <ul class="navbar-nav">
            <li class="nav-item">
              <button class="bton " href="#"><span class="btn-lk">About Us</span></button>
            </li>
            <li class="nav-item"></li>
            <form method="POST" action="sign_out"> 
              <button class="bton bt-cl" type="submit" >Logout</button>
          </form>
          </ul>
           
          
    

        </div>
        </div>
      </nav>
    <div class="topspace">
      <div class="container-fluid">
        <div class="row">
          <div class="col bt-space">
            <h5 class="sec-head">Live Feed</h5>
            <img id="feed" class="img-border"  alt="Image Loading">
            <span class="bold-weight">
              <p id="Status"></p>
              <p id="Resolution"></p>
              <p id="gpu"></p>
            </span>
          </div>
          <div class="col bt-space">
                 
            <h5 class="sec-head">Gender Classification</h5>
            <div id="gender"></div>
        </div>
        </div>
        <div class="row">
          <div class="col bt-space">
            <h5 class="sec-head">People Count</h5>
       
            <div id="chartContainer" style="height: 300px;" ></div>

          </div>
          
          <div class="col bt-space">
            <h5 class="sec-head">Attentiveness</h5>
            <div id="attentive"></div>
          </div>
        </div>
        </div>
      </div>
    </div>





      </div>
    </body>
    
    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script>
        var time=0;
        data0={};
        var dps = []; // dataPoints
        status=false;
        var chart = new CanvasJS.Chart("chartContainer", {
        axisX:{
          title:"TIme in seconds",
          interval:5
        },
	      axisY: {
          title:"People Count",
          includeZero: false,
          interval: 1
	      },      
	      data: [{
		      type: "line",
		      dataPoints: dps
	      }]
        });
        $("#Status").html('Status : <span class="red">Not Running</span>');
        var myImg = document.querySelector("#feed");
        var realWidth = myImg.clientWidth;
        var realHeight = myImg.clientHeight;
        $("#Resolution").html('Resolution :'+ realWidth +' x ' +realHeight);
        $.getJSON( "./FINAL/src/statusdata.json", function( data ) {
        if(data[0]['status']){
          $("#gpu").html('GPU : <span class="green">Enabled</span>');
        }
        else{
        $("#gpu").html('GPU : <span class="red">Disabled</span>');
        }
        });
        setInterval(function(){ $.getJSON( "./FINAL/src/4forces.json", function( data ) {
          var mcount = 0, fcount = 0;
          var attenCount = 0, nonAttenCount = 0;
          $("#attentive").html("");
          $("#gender").html("");

          $("#emotions").html("");
          if(status){
            $("#Status").html('Status : <span class="green"> Running</span>');
          }
          else{
            $("#Status").html('Status : <span class="red">Not Running</span>');
          }
          for (index = 0; index < data.length; index++) { 

              // attentive-counter
              if(data[index]['attentive'] == false){
                nonAttenCount += 1;
              }
              // else{
              //   nonAttenCount += 1;
              // }
              // ----------------
              // man-counter
              if(data[index]['gender'] == 'man'){
                mcount = mcount + 1;
              }

        }
        attenCount = data.length - nonAttenCount; 
        fcount = data.length - mcount; // woman-counter
        var totcount = data.length;
        var minutes = 1000 * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var date = new Date();
        //console.log(t);

      //-------------------------------------------------
      
      // Count vs time line graph
      

        function updateChart(count,dataLength){
          dps.push({
			      x: time,
			      y: totcount
          });
          if (dps.length > dataLength) {
		        dps.shift();
	        }
	        chart.render();
        }
        updateChart(totcount,20);
      //-------------------------------------------------
      // attentiveness bar graph
        $('<canvas id="barGraph"></canvas>').appendTo($("#attentive"));
              data1={};
              data1.labels=["Attentive", "Not-Attentive"];
              data1.datasets=[
                 {backgroundColor:["#14e34b","#e30b13"],data: [attenCount, nonAttenCount]}
              ];

             var ctx = $("#barGraph").get(0).getContext("2d");
                var myChart = new Chart(ctx, {
                  type: 'bar',
                  data: data1,
                  options: {
                            legend: {
                                      display: false
                            },
                            scales: {
                            yAxes: [{
                              ticks: {
                     stepSize: 1 // this worked as expected
                        }
            }]
        }
                  }
                });
      // -------------------------------
      // gender pie-chart
        $('<canvas id="pieChart"></canvas>').appendTo($("#gender"));
              data2={};
              data2.labels=["Male", "Female"];
              data2.datasets=[
                 {backgroundColor:["#213ceb","#f562ba"],data: [mcount, fcount]}
              ];

             var ctx = $("#pieChart").get(0).getContext("2d");
                var myChart = new Chart(ctx, {
                  type: 'doughnut',
                  data: data2,
                  
                 });
    // -----------------------------

        function toDataURL(url, callback) {
          var xhr = new XMLHttpRequest();
          xhr.onload = function() {
            var reader = new FileReader();
            reader.onloadend = function() {
              $('#feed').attr('src',url);
              status=true;
           }
            reader.readAsDataURL(xhr.response);
        };
          xhr.open('GET', url);
          xhr.responseType = 'blob';
          xhr.send();
        }
      
        toDataURL('bgr_img.jpg');
        });
        time++;
        }, 1000);
     </script>

  </body>
</html>